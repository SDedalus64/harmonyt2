#!/usr/bin/env sh

# Get staged files
staged_files=$(git diff --cached --name-only)

# Check if any staged files are in src/ directory
src_files=$(echo "$staged_files" | grep '^src/' || true)

# If there are src files but CHANGELOG.md is not staged, show a reminder
if [ -n "$src_files" ] && ! echo "$staged_files" | grep -q '^CHANGELOG.md$'; then
  # Output to stderr to try to make it visible in VS Code
  exec 1>&2
  echo ""
  echo "\033[1;33mğŸ“‹ CHANGELOG REMINDER\033[0m"
  echo ""
  echo "\033[1;34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\033[0m"
  echo "\033[1;34mâ„¹ï¸  Source code changes detected - Consider updating CHANGELOG.md\033[0m"
  echo "\033[1;34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\033[0m"
  echo ""
  echo "\033[0;34mSuggested sections under [Unreleased]:\033[0m"
  echo "  â€¢ Added - for new features"
  echo "  â€¢ Changed - for changes in existing functionality"
  echo "  â€¢ Fixed - for bug fixes"
  echo "  â€¢ Removed - for removed features"
  echo ""
  echo "\033[0;32mTo update changelog:\033[0m"
  echo "  1. Edit CHANGELOG.md"
  echo "  2. Stage with: git add CHANGELOG.md"
  echo ""
fi

# Run lint-staged
npx lint-staged
